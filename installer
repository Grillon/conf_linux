#!/usr/bin/env bash
base=$(pwd)
function install_brew {
	echo "brew install"
	ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install)"
}
function config_path {
	grep -qs linuxbrew $HOME/.bashrc
	if [ $? -eq 0 ];then return
	fi
	echo '#add theses lines to your .bashrc :
	export PATH="$HOME/.linuxbrew/bin:$PATH"
	export MANPATH="$HOME/.linuxbrew/share/man:$MANPATH"
	export INFOPATH="$HOME/.linuxbrew/share/info:$INFOPATH"
	'
}
function install_dependencies_redhat {
	sudo yum -y groupinstall 'Development Tools' && sudo yum -y install curl git irb python-setuptools ruby 
}

function install_dependencies_debian {
sudo apt-get install build-essential curl git python-setuptools ruby
}

function install_vimplug {
	curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
		https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
}
function install_nvim_tmux {
	brew install neovim/neovim/neovim
	pip2 install neovim
	pip3 install neovim
	gem install neovim
	brew install tmux
}

function install_tpm {
	git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
}

function install_nvim_health_stuff {
	brew install gcc
	brew install python
	brew install python3
	brew install ruby
	brew install xclip
	brew install xclip
	brew install xclip
}

function config_terminal {
	cd $base
	infocmp $TERM | sed 's/kbs=^[hH]/kbs=\\177/' > $TERM.ti
	tic $TERM.ti
}

function config_ln {
	cd $HOME/.config
	if [ ! -d nvim_old ];then
		mv nvim nvim_old
	fi
	ln -s $base/.config/nvim
	cd $HOME 
	if [[ ! -f .tmux.conf_old ]]
	then
		mv .tmux.conf .tmux.conf_old
		ln -s $base/.tmux.conf
	fi
	cd $base
}

function detect_os {
if [ -f /etc/debian_version ];then
	myos=debian
elif [ -f /etc/redhat-release ];then
	myos=redhat
else
	myos=unknown
fi
}

function auto {
	install_dependencies_$myos
	install_brew
	config_path
	config_path >> $HOME/.bashrc
	source $HOME/.bashrc
	install_nvim_health_stuff
	config_terminal
	install_nvim_tmux
	install_vimplug
	install_tpm
}
detect_os
if [ "$1" == 'all' ];then
	auto
fi
config_ln
cd $base
